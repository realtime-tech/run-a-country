<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Run A Country</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 3em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }
        
        .inherited-status {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 1.1em;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }
        
        .stat-card.changing {
            animation: pulse 0.5s ease;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .stat-card h3 {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
        }
        
        .stat-bar {
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .stat-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s ease;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .panel {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .panel h2 {
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255,255,255,0.3);
            padding-bottom: 10px;
        }
        
        .event-box {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #ff9800;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .event-title {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        .event-description {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .choices {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .btn-small {
            padding: 8px 15px;
            font-size: 0.9em;
        }
        
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .country-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .country-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .country-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(5px);
        }
        
        .country-name {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        
        .country-stats {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .relation {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            margin-top: 5px;
        }
        
        .relation-ally {
            background: #4CAF50;
        }
        
        .relation-friendly {
            background: #8BC34A;
        }
        
        .relation-neutral {
            background: #FFC107;
        }
        
        .relation-tense {
            background: #FF9800;
        }
        
        .relation-hostile {
            background: #F44336;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        .modal h2 {
            margin-bottom: 20px;
        }
        
        .action-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .log-entry {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .log-time {
            opacity: 0.6;
            font-size: 0.85em;
        }
        
        .game-over {
            text-align: center;
            padding: 40px;
        }
        
        .game-over h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #ff5252;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .input-group input,
        .input-group select {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 1em;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            color: white;
            font-size: 1em;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .tab.active {
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .war-panel {
            background: rgba(220, 38, 38, 0.2);
            border: 2px solid #dc2626;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .war-status {
            font-size: 1.2em;
            margin-bottom: 15px;
        }
        
        .nuke-progress {
            background: rgba(147, 51, 234, 0.2);
            border: 2px solid #9333ea;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .realtime-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 999;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏛️ RUN A COUNTRY 🏛️</h1>
            <p id="termInfo">Year 1, Month 1</p>
            <div class="inherited-status" id="inheritedStatus"></div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card" id="treasuryCard">
                <h3>💰 Treasury</h3>
                <div class="stat-value" id="treasury">$0T</div>
            </div>
            <div class="stat-card" id="approvalCard">
                <h3>😊 Public Approval</h3>
                <div class="stat-value" id="approval">0%</div>
                <div class="stat-bar"><div class="stat-bar-fill" id="approvalBar"></div></div>
            </div>
            <div class="stat-card" id="economyCard">
                <h3>🏭 Economy</h3>
                <div class="stat-value" id="economy">0</div>
                <div class="stat-bar"><div class="stat-bar-fill" id="economyBar"></div></div>
            </div>
            <div class="stat-card" id="militaryCard">
                <h3>🎖️ Military</h3>
                <div class="stat-value" id="military">0</div>
                <div class="stat-bar"><div class="stat-bar-fill" id="militaryBar"></div></div>
            </div>
            <div class="stat-card" id="healthcareCard">
                <h3>🏥 Healthcare</h3>
                <div class="stat-value" id="healthcare">0</div>
                <div class="stat-bar"><div class="stat-bar-fill" id="healthcareBar"></div></div>
            </div>
            <div class="stat-card" id="educationCard">
                <h3>📚 Education</h3>
                <div class="stat-value" id="education">0</div>
                <div class="stat-bar"><div class="stat-bar-fill" id="educationBar"></div></div>
            </div>
            <div class="stat-card" id="relationsCard">
                <h3>🌍 International Relations</h3>
                <div class="stat-value" id="relations">0</div>
                <div class="stat-bar"><div class="stat-bar-fill" id="relationsBar"></div></div>
            </div>
            <div class="stat-card" id="resourcesCard">
                <h3>🌾 Resources</h3>
                <div class="stat-value" id="resources">0</div>
                <div class="stat-bar"><div class="stat-bar-fill" id="resourcesBar"></div></div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="panel">
                <h2>📰 Current Events</h2>
                <div id="warPanel"></div>
                <div id="nukePanel"></div>
                <div id="eventsContainer">
                    <div class="event-box">
                        <div class="event-title">Welcome, Mr./Ms. President!</div>
                        <div class="event-description">
                            You're about to take office. Click below to see what kind of situation you're inheriting...
                        </div>
                        <div class="choices">
                            <button class="btn btn-primary" onclick="startGame()">Take Office</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('actions')">Actions</button>
                    <button class="tab" onclick="switchTab('countries')">Countries</button>
                    <button class="tab" onclick="switchTab('log')">Activity Log</button>
                </div>
                
                <div id="actionsTab" class="tab-content active">
                    <h2>Executive Actions</h2>
                    <div class="actions-grid">
                        <button class="btn btn-primary btn-small" onclick="openEconomyMenu()">💼 Economy</button>
                        <button class="btn btn-primary btn-small" onclick="openMilitaryMenu()">⚔️ Military</button>
                        <button class="btn btn-primary btn-small" onclick="openDomesticMenu()">🏛️ Domestic</button>
                        <button class="btn btn-primary btn-small" onclick="openTradeMenu()">📦 Trade</button>
                        <button class="btn btn-secondary btn-small" onclick="advanceMonth()">⏭️ Next Month</button>
                        <button class="btn btn-success btn-small" onclick="exportGame()">💾 Export</button>
                        <button class="btn btn-success btn-small" onclick="importGame()">📂 Import</button>
                        <button class="btn btn-danger btn-small" onclick="resetGame()">🔄 New Game</button>
                    </div>
                </div>
                
                <div id="countriesTab" class="tab-content">
                    <h2>World Powers</h2>
                    <div class="country-list" id="countryList"></div>
                </div>
                
                <div id="logTab" class="tab-content">
                    <h2>Activity Log</h2>
                    <div id="activityLog" style="max-height: 400px; overflow-y: auto;"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="realtime-toggle">
        <button class="btn btn-secondary btn-small" onclick="toggleRealtime()" id="realtimeBtn">
            ⏸️ Pause Realtime
        </button>
    </div>
    
    <div id="modal" class="modal">
        <div class="modal-content" id="modalContent"></div>
    </div>
    
    <script>
        // Game State
        let gameState = {
            year: 1,
            month: 1,
            treasury: 5.0,
            approval: 55,
            economy: 60,
            military: 50,
            healthcare: 50,
            education: 50,
            relations: 50,
            resources: 70,
            countries: [],
            activityLog: [],
            activeEvent: null,
            taxRate: 25,
            militaryBudget: 20,
            healthcareBudget: 15,
            educationBudget: 15,
            eventCooldown: 0,
            wars: [],
            nukeProgram: null,
            realtimeEnabled: true,
            inheritedCondition: "",
            gameStarted: false
        };
        
        let realtimeInterval = null;
        
        const countryNames = [
            "Novaria", "Solantis", "Westholm", "Meridian", "Arcturia",
            "Zephyria", "Eldoria", "Valoria", "Austrium", "Borealis",
            "Cascadia", "Tempest", "Aethel", "Cyrenia", "Dalmora"
        ];
        
        const relationLevels = ["hostile", "tense", "neutral", "friendly", "ally"];
        
        const inheritedConditions = [
            {
                name: "Economic Disaster",
                description: "The previous administration left the country in ruins. Debt is crushing, the economy is collapsing, and the people are angry.",
                effects: { treasury: 1.5, economy: 25, approval: 30, healthcare: 35, education: 35 }
            },
            {
                name: "Post-War Recovery",
                description: "The nation just emerged from a devastating war. Military is depleted, resources are low, but there's hope for rebuilding.",
                effects: { treasury: 3.0, military: 25, resources: 35, approval: 45, economy: 40 }
            },
            {
                name: "Golden Age",
                description: "You've inherited a thriving nation at its peak. Economy booming, people happy, strong military. Don't mess it up!",
                effects: { treasury: 8.0, economy: 85, approval: 75, military: 70, healthcare: 70, education: 70 }
            },
            {
                name: "Political Crisis",
                description: "The government is in chaos. Previous president resigned in scandal. Approval is rock bottom but everything else is okay.",
                effects: { treasury: 4.5, approval: 20, economy: 55, military: 50, healthcare: 50, education: 50 }
            },
            {
                name: "Rising Power",
                description: "The country is on the rise. Not the best, not the worst, but momentum is building and opportunities are everywhere.",
                effects: { treasury: 5.5, economy: 65, approval: 60, military: 55, healthcare: 55, education: 60 }
            },
            {
                name: "Isolated Nation",
                description: "Years of isolation have left the country self-reliant but backwards. Strong resources, weak international standing.",
                effects: { treasury: 4.0, resources: 85, relations: 25, economy: 45, military: 40, healthcare: 40, education: 35 }
            },
            {
                name: "Healthcare Crisis",
                description: "A pandemic just swept through. Healthcare system is overwhelmed, economy damaged, but the worst may be over.",
                effects: { treasury: 3.5, healthcare: 20, economy: 45, approval: 40, education: 50, military: 50 }
            },
            {
                name: "Military Superpower",
                description: "The nation is a military juggernaut but other areas have been neglected. Will you maintain dominance or pivot?",
                effects: { treasury: 6.0, military: 90, economy: 50, healthcare: 40, education: 40, relations: 45 }
            }
        ];
        
        function initGame() {
            // Randomly select inherited condition
            const condition = inheritedConditions[Math.floor(Math.random() * inheritedConditions.length)];
            gameState.inheritedCondition = condition.name;
            
            // Apply condition effects
            Object.keys(condition.effects).forEach(key => {
                if (gameState[key] !== undefined) {
                    gameState[key] = condition.effects[key];
                }
            });
            
            // Display inherited status
            document.getElementById('inheritedStatus').innerHTML = `
                <strong>⚠️ INHERITED SITUATION: ${condition.name}</strong><br>
                ${condition.description}
            `;
            
            // Create countries with varying starting relations
            gameState.countries = [];
            const numCountries = 8 + Math.floor(Math.random() * 5);
            const shuffled = [...countryNames].sort(() => Math.random() - 0.5);
            
            for (let i = 0; i < numCountries; i++) {
                const relationValue = Math.floor(Math.random() * 80) + 10;
                gameState.countries.push({
                    name: shuffled[i],
                    relation: getRelationLevel(relationValue),
                    relationValue: relationValue,
                    military: 30 + Math.floor(Math.random() * 40),
                    economy: 40 + Math.floor(Math.random() * 30),
                    tradeAgreement: Math.random() < 0.2,
                    tensions: Math.random() < 0.3 ? Math.floor(Math.random() * 20) : 0,
                    atWarWithUs: false,
                    atWarWith: null
                });
            }
            
            gameState.gameStarted = true;
            updateUI();
            renderCountries();
            addLog(`You have inherited: ${condition.name}`);
            
            // Start realtime simulation
            startRealtime();
            
            // Clear initial event
            document.getElementById('eventsContainer').innerHTML = `
                <div class="event-box">
                    <div class="event-title">Your Term Begins</div>
                    <div class="event-description">
                        The world is watching. What will you do first? Events will unfold in real-time...
                    </div>
                </div>
            `;
            
            // Trigger first event soon
            setTimeout(triggerRandomEvent, 5000);
        }
        
        function startGame() {
            initGame();
        }
        
        function startRealtime() {
            if (realtimeInterval) clearInterval(realtimeInterval);
            
            realtimeInterval = setInterval(() => {
                if (!gameState.realtimeEnabled || !gameState.gameStarted) return;
                
                // Random events between countries
                if (Math.random() < 0.15) {
                    countryToCountryEvent();
                }
                
                // Random tensions escalating
                if (Math.random() < 0.2) {
                    escalateTensions();
                }
                
                // Random country declares war on us
                if (Math.random() < 0.05) {
                    randomWarDeclaration();
                }
                
                // Natural stat drift
                gameState.economy += (Math.random() - 0.5) * 2;
                gameState.approval += (Math.random() - 0.5) * 1.5;
                
                // Update nuke program
                if (gameState.nukeProgram) {
                    gameState.nukeProgram.progress += Math.random() * 3;
                    if (gameState.nukeProgram.progress >= 100) {
                        completeNukeProgram();
                    }
                    updateNukePanel();
                }
                
                // Update wars
                if (gameState.wars.length > 0) {
                    updateWars();
                }
                
                clampStats();
                updateUI();
                
            }, 3000); // Every 3 seconds
        }
        
        function toggleRealtime() {
            gameState.realtimeEnabled = !gameState.realtimeEnabled;
            const btn = document.getElementById('realtimeBtn');
            btn.textContent = gameState.realtimeEnabled ? '⏸️ Pause Realtime' : '▶️ Resume Realtime';
            addLog(gameState.realtimeEnabled ? "Realtime simulation resumed" : "Realtime simulation paused");
        }
        
        function countryToCountryEvent() {
            if (gameState.countries.length < 2) return;
            
            const c1 = gameState.countries[Math.floor(Math.random() * gameState.countries.length)];
            const c2 = gameState.countries[Math.floor(Math.random() * gameState.countries.length)];
            
            if (c1 === c2) return;
            
            const events = [
                `${c1.name} and ${c2.name} sign trade agreement`,
                `${c1.name} accuses ${c2.name} of espionage`,
                `Border dispute erupts between ${c1.name} and ${c2.name}`,
                `${c1.name} and ${c2.name} form defensive alliance`,
                `${c1.name} imposes sanctions on ${c2.name}`,
                `${c1.name} sends humanitarian aid to ${c2.name}`
            ];
            
            const event = events[Math.floor(Math.random() * events.length)];
            addLog(`🌍 WORLD EVENT: ${event}`);
            
            // Sometimes affects us
            if (Math.random() < 0.3) {
                gameState.relations += (Math.random() - 0.5) * 5;
            }
        }
        
        function escalateTensions() {
            const hostilesOrTense = gameState.countries.filter(c => 
                (c.relation === 'hostile' || c.relation === 'tense') && !c.atWarWithUs
            );
            
            if (hostilesOrTense.length === 0) return;
            
            const country = hostilesOrTense[Math.floor(Math.random() * hostilesOrTense.length)];
            country.tensions += Math.floor(Math.random() * 10) + 5;
            
            addLog(`⚠️ ALERT: Tensions with ${country.name} are rising! (${country.tensions})`);
            
            if (country.tensions > 60 && Math.random() < 0.4) {
                createWarWarning(country);
            }
            
            renderCountries();
        }
        
        function randomWarDeclaration() {
            const hostiles = gameState.countries.filter(c => 
                c.relation === 'hostile' && !c.atWarWithUs && c.tensions > 40
            );
            
            if (hostiles.length === 0) return;
            
            const country = hostiles[Math.floor(Math.random() * hostiles.length)];
            
            addLog(`🚨 BREAKING: ${country.name} has DECLARED WAR on us!`);
            
            const event = {
                type: "war_declared",
                title: `⚔️ WAR DECLARED BY ${country.name}`,
                description: `${country.name} has officially declared war! Their military is mobilizing. You must respond immediately!`,
                choices: [
                    { text: "Accept War & Fight Back", action: () => acceptWar(country) },
                    { text: "Seek Emergency Peace (-$1.5T)", cost: 1.5, action: () => emergencyPeace(country) },
                    { text: "Call for International Coalition", action: () => seekCoalition(country) }
                ]
            };
            
            displayEvent(event);
        }
        
        function acceptWar(country) {
            country.atWarWithUs = true;
            gameState.wars.push({
                enemy: country.name,
                monthsActive: 0,
                ourCasualties: 0,
                theirCasualties: 0,
                battlesFought: 0
            });
            
            addLog(`WAR BEGUN: You are now at war with ${country.name}!`);
            updateWarPanel();
            closeModal();
        }
        
        function emergencyPeace(country) {
            if (gameState.treasury < 1.5) {
                addLog("Insufficient funds for emergency peace!");
                return;
            }
            
            gameState.treasury -= 1.5;
            country.tensions = 0;
            country.relationValue = 40;
            country.relation = "neutral";
            gameState.approval -= 15;
            
            addLog(`Expensive peace achieved with ${country.name}. Public views you as weak.`);
            updateUI();
            closeModal();
        }
        
        function seekCoalition(country) {
            const allies = gameState.countries.filter(c => c.relation === 'ally' || c.relation === 'friendly');
            
            if (allies.length < 2) {
                addLog("Not enough allies to form a coalition!");
                acceptWar(country);
                return;
            }
            
            country.military -= 20;
            gameState.relations += 10;
            country.tensions = 0;
            country.relationValue = 30;
            
            addLog(`Coalition formed! ${country.name} backs down in face of international pressure.`);
            updateUI();
            closeModal();
        }
        
        function createWarWarning(country) {
            const event = {
                type: "war_warning",
                title: `⚠️ WAR WARNING: ${country.name}`,
                description: `Intelligence reports that ${country.name} is preparing for war. Tensions are at ${country.tensions}. What is your response?`,
                choices: [
                    { text: "Pre-emptive Strike (-$0.8T)", cost: 0.8, action: () => preemptiveStrike(country) },
                    { text: "Massive Military Buildup (-$1.2T)", cost: 1.2, action: () => militaryBuildup(country) },
                    { text: "Diplomatic De-escalation", action: () => deescalate(country) },
                    { text: "Do Nothing", action: () => { country.tensions += 10; closeModal(); } }
                ]
            };
            displayEvent(event);
        }
        
        function preemptiveStrike(country) {
            if (gameState.treasury < 0.8) {
                addLog("Insufficient funds!");
                return;
            }
            
            gameState.treasury -= 0.8;
            country.atWarWithUs = true;
            country.military -= 15;
            gameState.relations -= 20;
            gameState.approval -= 10;
            
            gameState.wars.push({
                enemy: country.name,
                monthsActive: 0,
                ourCasualties: 0,
                theirCasualties: 0,
                battlesFought: 0
            });
            
            addLog(`Pre-emptive strike launched against ${country.name}! War has begun.`);
            updateWarPanel();
            updateUI();
            closeModal();
        }
        
        function militaryBuildup(country) {
            if (gameState.treasury < 1.2) {
                addLog("Insufficient funds!");
                return;
            }
            
            gameState.treasury -= 1.2;
            gameState.military += 15;
            country.tensions -= 20;
            gameState.relations -= 5;
            
            addLog(`Massive military buildup completed. ${country.name} reconsiders their position.`);
            updateUI();
            closeModal();
        }
        
        function deescalate(country) {
            const success = Math.random() < 0.6;
            
            if (success) {
                country.tensions = Math.floor(country.tensions / 2);
                country.relationValue += 10;
                country.relation = getRelationLevel(country.relationValue);
                gameState.approval += 5;
                addLog(`Successful diplomacy with ${country.name}. Crisis averted!`);
            } else {
                country.tensions += 15;
                addLog(`Diplomacy failed. ${country.name} sees it as weakness.`);
            }
            
            updateUI();
            renderCountries();
            closeModal();
        }
        
        function updateWars() {
            if (gameState.wars.length === 0) return;
            
            gameState.wars.forEach(war => {
                const enemy = gameState.countries.find(c => c.name === war.enemy);
                if (!enemy) return;
                
                // Monthly war updates
                war.monthsActive++;
                
                // Battle simulation
                const ourStrength = gameState.military + Math.random() * 20;
                const theirStrength = enemy.military + Math.random() * 20;
                
                if (ourStrength > theirStrength) {
                    const casualties = Math.floor(Math.random() * 5) + 1;
                    war.theirCasualties += casualties;
                    enemy.military -= 2;
                    addLog(`⚔️ Victory in battle against ${war.enemy}! Enemy losses mounting.`);
                } else {
                    const casualties = Math.floor(Math.random() * 5) + 1;
                    war.ourCasualties += casualties;
                    gameState.military -= 2;
                    gameState.approval -= 3;
                    addLog(`⚔️ Setback in war with ${war.enemy}. Casualties reported.`);
                }
                
                war.battlesFought++;
                
                // War costs
                gameState.treasury -= 0.2;
                
                updateWarPanel();
            });
        }
        
        function updateWarPanel() {
            const panel = document.getElementById('warPanel');
            
            if (gameState.wars.length === 0) {
                panel.innerHTML = '';
                return;
            }
            
            panel.innerHTML = gameState.wars.map(war => {
                const enemy = gameState.countries.find(c => c.name === war.enemy);
                return `
                    <div class="war-panel">
                        <div class="war-status">
                            ⚔️ AT WAR WITH ${war.enemy}
                        </div>
                        <p>Duration: ${war.monthsActive} months | Battles: ${war.battlesFought}</p>
                        <p>Our Casualties: ${war.ourCasualties} | Enemy Casualties: ${war.theirCasualties}</p>
                        <p>Enemy Military Strength: ${enemy ? enemy.military : 'Unknown'}</p>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button class="btn btn-primary btn-small" onclick="warAction('${war.enemy}', 'offensive')">
                                🗡️ Major Offensive (-$0.5T)
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="warAction('${war.enemy}', 'defensive')">
                                🛡️ Defensive Stance
                            </button>
                            <button class="btn btn-danger btn-small" onclick="warAction('${war.enemy}', 'surrender')">
                                🏳️ Surrender
                            </button>
                            <button class="btn btn-success btn-small" onclick="warAction('${war.enemy}', 'peace')">
                                ☮️ Offer Peace
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function warAction(enemyName, action) {
            const war = gameState.wars.find(w => w.enemy === enemyName);
            const enemy = gameState.countries.find(c => c.name === enemyName);
            
            if (!war || !enemy) return;
            
            switch(action) {
                case 'offensive':
                    if (gameState.treasury < 0.5) {
                        addLog("Insufficient funds for offensive!");
                        return;
                    }
                    gameState.treasury -= 0.5;
                    
                    const offensiveSuccess = gameState.military > enemy.military * 0.8;
                    if (offensiveSuccess) {
                        enemy.military -= 15;
                        war.theirCasualties += 10;
                        addLog(`🗡️ Major offensive successful! ${enemyName} forces decimated.`);
                        
                        if (enemy.military < 20) {
                            endWar(enemyName, 'victory');
                        }
                    } else {
                        gameState.military -= 10;
                        war.ourCasualties += 8;
                        gameState.approval -= 10;
                        addLog(`🗡️ Offensive failed. Heavy losses sustained.`);
                    }
                    break;
                    
                    case 'defensive':
                    gameState.military += 3;
                    addLog(`🛡️ Defensive positions reinforced.`);
                    break;
                    
                case 'surrender':
                    if (confirm(`Surrender to ${enemyName}? This will have severe consequences!`)) {
                        endWar(enemyName, 'defeat');
                    }
                    break;
                    
                case 'peace':
                    const peaceCost = 0.5 + (Math.random() * 0.5);
                    if (gameState.treasury < peaceCost) {
                        addLog("Insufficient funds for peace negotiations!");
                        return;
                    }
                    
                    const peaceAccepted = Math.random() < 0.5 || enemy.military < 30;
                    if (peaceAccepted) {
                        gameState.treasury -= peaceCost;
                        endWar(enemyName, 'peace');
                    } else {
                        addLog(`${enemyName} rejects peace offer! They want total victory.`);
                    }
                    break;
            }
            
            clampStats();
            updateUI();
            updateWarPanel();
        }
        
        function endWar(enemyName, outcome) {
            const warIndex = gameState.wars.findIndex(w => w.enemy === enemyName);
            const enemy = gameState.countries.find(c => c.name === enemyName);
            
            if (warIndex === -1 || !enemy) return;
            
            gameState.wars.splice(warIndex, 1);
            enemy.atWarWithUs = false;
            
            switch(outcome) {
                case 'victory':
                    gameState.approval += 20;
                    gameState.military += 10;
                    gameState.treasury += 1.0;
                    enemy.relationValue = 20;
                    addLog(`🎉 VICTORY! ${enemyName} has been defeated!`);
                    break;
                    
                case 'defeat':
                    gameState.approval -= 30;
                    gameState.military -= 20;
                    gameState.treasury -= 2.0;
                    gameState.economy -= 15;
                    enemy.relationValue = 10;
                    addLog(`💀 DEFEAT. ${enemyName} has won the war.`);
                    break;
                    
                case 'peace':
                    enemy.relationValue = 50;
                    enemy.tensions = 0;
                    addLog(`☮️ Peace treaty signed with ${enemyName}.`);
                    break;
            }
            
            enemy.relation = getRelationLevel(enemy.relationValue);
            updateWarPanel();
            renderCountries();
            clampStats();
            updateUI();
        }
        
        function startNukeProgram() {
            if (gameState.nukeProgram) {
                addLog("Nuclear program already underway!");
                return;
            }
            
            if (gameState.treasury < 3.0) {
                addLog("Insufficient funds to start nuclear program!");
                return;
            }
            
            gameState.treasury -= 3.0;
            gameState.nukeProgram = {
                progress: 0,
                monthsActive: 0
            };
            
            gameState.relations -= 25;
            gameState.approval -= 15;
            
            addLog("☢️ NUCLEAR WEAPONS PROGRAM INITIATED. The world is alarmed.");
            updateNukePanel();
            updateUI();
        }
        
        function updateNukePanel() {
            const panel = document.getElementById('nukePanel');
            
            if (!gameState.nukeProgram) {
                panel.innerHTML = '';
                return;
            }
            
            panel.innerHTML = `
                <div class="nuke-progress">
                    <div style="font-size: 1.2em; margin-bottom: 10px;">
                        ☢️ NUCLEAR WEAPONS PROGRAM
                    </div>
                    <p>Progress: ${Math.floor(gameState.nukeProgram.progress)}%</p>
                    <div class="stat-bar">
                        <div class="stat-bar-fill" style="width: ${gameState.nukeProgram.progress}%; background: linear-gradient(90deg, #9333ea, #c084fc);"></div>
                    </div>
                    <p style="margin-top: 10px; font-size: 0.9em;">Development ongoing... International condemnation growing.</p>
                </div>
            `;
        }
        
        function completeNukeProgram() {
            gameState.military += 40;
            gameState.relations -= 30;
            gameState.approval -= 10;
            
            addLog("☢️ NUCLEAR WEAPONS OPERATIONAL. You are now a nuclear power.");
            
            const nukePanel = document.getElementById('nukePanel');
            nukePanel.innerHTML = `
                <div class="nuke-progress">
                    <div style="font-size: 1.2em; margin-bottom: 10px;">
                        ☢️ NUCLEAR ARSENAL ACTIVE
                    </div>
                    <p>You possess nuclear weapons. The ultimate deterrent.</p>
                    <button class="btn btn-danger btn-small" style="margin-top: 10px;" onclick="openNukeMenu()">
                        ☢️ Nuclear Options
                    </button>
                </div>
            `;
            
            gameState.nukeProgram.complete = true;
            clampStats();
            updateUI();
        }
        
        function openNukeMenu() {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');
            
            const targets = gameState.countries.filter(c => c.atWarWithUs || c.relation === 'hostile');
            
            content.innerHTML = `
                <h2>☢️ Nuclear Weapons</h2>
                <p style="color: #ff5252; margin-bottom: 20px;">
                    <strong>WARNING:</strong> Use of nuclear weapons will have catastrophic consequences.
                </p>
                
                ${targets.length > 0 ? `
                    <h3>Potential Targets:</h3>
                    ${targets.map(c => `
                        <button class="btn btn-danger" style="margin: 5px;" onclick="launchNuke('${c.name}')">
                            Launch at ${c.name}
                        </button>
                    `).join('')}
                ` : '<p>No current hostile targets.</p>'}
                
                <button class="btn btn-success" style="margin-top: 20px;" onclick="closeModal()">Close</button>
            `;
            
            modal.style.display = 'flex';
        }
        
        function launchNuke(targetName) {
            if (!confirm(`Launch nuclear weapons at ${targetName}? This is irreversible and will change everything!`)) {
                return;
            }
            
            const target = gameState.countries.find(c => c.name === targetName);
            
            // Devastating consequences
            target.military = 0;
            target.economy = 0;
            target.relationValue = 0;
            target.relation = 'hostile';
            
            gameState.relations -= 50;
            gameState.approval -= 40;
            gameState.economy -= 20;
            
            // End war if active
            const warIndex = gameState.wars.findIndex(w => w.enemy === targetName);
            if (warIndex !== -1) {
                gameState.wars.splice(warIndex, 1);
                target.atWarWithUs = false;
            }
            
            addLog(`☢️ NUCLEAR STRIKE: ${targetName} has been obliterated. The world is in shock.`);
            
            // Massive international backlash
            gameState.countries.forEach(c => {
                if (c.name !== targetName) {
                    c.relationValue -= 30;
                    c.relation = getRelationLevel(c.relationValue);
                }
            });
            
            closeModal();
            updateWarPanel();
            renderCountries();
            clampStats();
            updateUI();
        }
        
        function updateUI() {
            document.getElementById('termInfo').textContent = `Year ${gameState.year}, Month ${gameState.month}`;
            document.getElementById('treasury').textContent = `${gameState.treasury.toFixed(1)}T`;
            document.getElementById('approval').textContent = `${gameState.approval}%`;
            document.getElementById('economy').textContent = gameState.economy.toFixed(0);
            document.getElementById('military').textContent = gameState.military.toFixed(0);
            document.getElementById('healthcare').textContent = gameState.healthcare.toFixed(0);
            document.getElementById('education').textContent = gameState.education.toFixed(0);
            document.getElementById('relations').textContent = gameState.relations.toFixed(0);
            document.getElementById('resources').textContent = gameState.resources.toFixed(0);
            
            updateBar('approvalBar', gameState.approval);
            updateBar('economyBar', gameState.economy);
            updateBar('militaryBar', gameState.military);
            updateBar('healthcareBar', gameState.healthcare);
            updateBar('educationBar', gameState.education);
            updateBar('relationsBar', gameState.relations);
            updateBar('resourcesBar', gameState.resources);
            
            if (gameState.approval <= 0 || gameState.treasury <= 0) {
                gameOver();
            }
        }
        
        function animateStatChange(statName) {
            const card = document.getElementById(statName + 'Card');
            if (card) {
                card.classList.add('changing');
                setTimeout(() => card.classList.remove('changing'), 500);
            }
        }
        
        function updateBar(id, value) {
            const bar = document.getElementById(id);
            bar.style.width = `${Math.min(100, Math.max(0, value))}%`;
            
            if (value < 30) {
                bar.style.background = 'linear-gradient(90deg, #f44336, #e57373)';
            } else if (value < 60) {
                bar.style.background = 'linear-gradient(90deg, #ff9800, #ffb74d)';
            } else {
                bar.style.background = 'linear-gradient(90deg, #4CAF50, #8BC34A)';
            }
        }
        
        function advanceMonth() {
            gameState.month++;
            if (gameState.month > 12) {
                gameState.month = 1;
                gameState.year++;
            }
            
            const taxRevenue = (gameState.taxRate / 100) * (gameState.economy / 20);
            gameState.treasury += taxRevenue;
            
            gameState.treasury -= (gameState.militaryBudget / 100) * 0.5;
            gameState.treasury -= (gameState.healthcareBudget / 100) * 0.4;
            gameState.treasury -= (gameState.educationBudget / 100) * 0.3;
            
            gameState.economy += Math.floor(Math.random() * 3) - 1;
            gameState.approval += Math.floor(Math.random() * 5) - 2;
            
            gameState.military += Math.floor(gameState.militaryBudget / 10) - 2;
            gameState.healthcare += Math.floor(gameState.healthcareBudget / 10) - 1;
            gameState.education += Math.floor(gameState.educationBudget / 10) - 1;
            
            gameState.countries.forEach(c => {
                c.relationValue += Math.floor(Math.random() * 5) - 2;
                c.relationValue = Math.max(0, Math.min(100, c.relationValue));
                c.relation = getRelationLevel(c.relationValue);
                
                if (c.tensions > 0 && !c.atWarWithUs) {
                    c.tensions += Math.floor(Math.random() * 3);
                }
            });
            
            clampStats();
            
            if (gameState.eventCooldown <= 0 && Math.random() < 0.6) {
                triggerRandomEvent();
                gameState.eventCooldown = 1;
            } else {
                gameState.eventCooldown--;
            }
            
            updateUI();
            renderCountries();
            addLog(`Month ${gameState.month} of Year ${gameState.year} complete. Treasury: ${gameState.treasury.toFixed(1)}T`);
        }
        
        function clampStats() {
            gameState.approval = Math.max(0, Math.min(100, gameState.approval));
            gameState.economy = Math.max(0, Math.min(100, gameState.economy));
            gameState.military = Math.max(0, Math.min(100, gameState.military));
            gameState.healthcare = Math.max(0, Math.min(100, gameState.healthcare));
            gameState.education = Math.max(0, Math.min(100, gameState.education));
            gameState.relations = Math.max(0, Math.min(100, gameState.relations));
            gameState.resources = Math.max(0, Math.min(100, gameState.resources));
        }
        
        const eventTemplates = [
            {
                type: "economic",
                title: "Stock Market Volatility",
                description: "The stock market is experiencing unusual volatility. Investors are nervous.",
                choices: [
                    { text: "Inject capital to stabilize (-$0.5T)", cost: 0.5, effects: { economy: 5, approval: 3 } },
                    { text: "Let the market self-correct", effects: { economy: -8, approval: -5 } },
                    { text: "Implement trading restrictions", effects: { economy: -3, approval: -2 } }
                ]
            },
            {
                type: "domestic",
                title: "Healthcare Crisis",
                description: "A new virus is spreading. Hospitals are overwhelmed.",
                choices: [
                    { text: "Emergency funding (-$1.0T)", cost: 1.0, effects: { healthcare: 15, approval: 10 } },
                    { text: "Implement lockdown", effects: { healthcare: 5, economy: -10, approval: -8 } },
                    { text: "Let it pass naturally", effects: { healthcare: -15, approval: -20 } }
                ]
            },
            {
                type: "international",
                title: "Trade Dispute",
                description: "A major trading partner is threatening tariffs on our exports.",
                choices: [
                    { text: "Negotiate a deal", effects: { economy: 3, relations: 5 } },
                    { text: "Impose counter-tariffs", effects: { economy: -5, relations: -10 } },
                    { text: "Seek alternative markets", effects: { economy: 2, resources: -5 } }
                ]
            },
            {
                type: "crisis",
                title: "Natural Disaster",
                description: "A major earthquake has struck. Thousands need immediate aid.",
                choices: [
                    { text: "Full emergency response (-$0.8T)", cost: 0.8, effects: { approval: 15, healthcare: 5 } },
                    { text: "Standard relief efforts (-$0.4T)", cost: 0.4, effects: { approval: 8, healthcare: 2 } },
                    { text: "Minimal intervention (-$0.1T)", cost: 0.1, effects: { approval: -12, healthcare: -5 } }
                ]
            },
            {
                type: "opportunity",
                title: "Tech Industry Boom",
                description: "A tech boom is creating jobs and growth opportunities.",
                choices: [
                    { text: "Invest in infrastructure (-$0.6T)", cost: 0.6, effects: { economy: 12, education: 5 } },
                    { text: "Provide tax incentives", effects: { economy: 8, treasury: -0.3 } },
                    { text: "Let it grow organically", effects: { economy: 5 } }
                ]
            }
        ];
        
        function triggerRandomEvent() {
            const event = eventTemplates[Math.floor(Math.random() * eventTemplates.length)];
            displayEvent(event);
        }
        
        function displayEvent(event) {
            const container = document.getElementById('eventsContainer');
            container.innerHTML = `
                <div class="event-box">
                    <div class="event-title">${event.title}</div>
                    <div class="event-description">${event.description}</div>
                    <div class="choices">
                        ${event.choices.map((choice, i) => `
                            <button class="btn btn-primary" onclick="handleChoice(${i})">
                                ${choice.text}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
            gameState.activeEvent = event;
        }
        
        function handleChoice(choiceIndex) {
            const choice = gameState.activeEvent.choices[choiceIndex];
            
            if (choice.cost && gameState.treasury < choice.cost) {
                addLog("Insufficient funds for this action!");
                return;
            }
            
            if (choice.cost) {
                gameState.treasury -= choice.cost;
            }
            
            if (choice.effects) {
                Object.keys(choice.effects).forEach(stat => {
                    if (gameState[stat] !== undefined) {
                        gameState[stat] += choice.effects[stat];
                        animateStatChange(stat);
                    }
                });
            }
            
            if (choice.action) {
                choice.action();
            }
            
            clampStats();
            updateUI();
            addLog(`Decision made: ${choice.text}`);
            
            document.getElementById('eventsContainer').innerHTML = `
                <div class="event-box">
                    <div class="event-title">No Current Events</div>
                    <div class="event-description">The situation is calm for now. Monitor the world situation...</div>
                </div>
            `;
            
            gameState.activeEvent = null;
        }
        
        function getRelationLevel(value) {
            if (value < 20) return "hostile";
            if (value < 40) return "tense";
            if (value < 60) return "neutral";
            if (value < 80) return "friendly";
            return "ally";
        }
        
        function renderCountries() {
            const list = document.getElementById('countryList');
            list.innerHTML = gameState.countries.map(c => `
                <div class="country-item" onclick="openCountryMenu('${c.name}')">
                    <div class="country-name">${c.name} ${c.atWarWithUs ? '⚔️ AT WAR' : ''}</div>
                    <div class="country-stats">
                        Military: ${c.military} | Economy: ${c.economy}
                        ${c.tradeAgreement ? ' | 📦 Trade Partner' : ''}
                        ${c.tensions > 0 ? ` | ⚠️ Tensions: ${c.tensions}` : ''}
                    </div>
                    <span class="relation relation-${c.relation}">${c.relation.toUpperCase()}</span>
                </div>
            `).join('');
        }
        
        function openCountryMenu(countryName) {
            const country = gameState.countries.find(c => c.name === countryName);
            if (!country) return;
            
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <h2>${country.name} ${country.atWarWithUs ? '⚔️' : ''}</h2>
                <p><strong>Relationship:</strong> <span class="relation relation-${country.relation}">${country.relation.toUpperCase()}</span> (${country.relationValue}/100)</p>
                <p><strong>Military Strength:</strong> ${country.military}</p>
                <p><strong>Economic Power:</strong> ${country.economy}</p>
                <p><strong>Trade Agreement:</strong> ${country.tradeAgreement ? 'Yes' : 'No'}</p>
                <p><strong>Tensions:</strong> ${country.tensions}</p>
                
                <div class="action-options">
                    ${!country.atWarWithUs ? `
                        <button class="btn btn-primary" onclick="diplomaticAction('${countryName}', 'gift')">
                            💰 Send Aid (-$0.3T, +Relations)
                        </button>
                        <button class="btn btn-primary" onclick="diplomaticAction('${countryName}', 'trade')">
                            📦 ${country.tradeAgreement ? 'Cancel Trade' : 'Trade Agreement'}
                        </button>
                        <button class="btn btn-primary" onclick="diplomaticAction('${countryName}', 'alliance')">
                            🤝 Propose Alliance (-$0.5T)
                        </button>
                        <button class="btn btn-secondary" onclick="diplomaticAction('${countryName}', 'threaten')">
                            ⚔️ Military Threats (-Relations)
                        </button>
                        <button class="btn btn-danger" onclick="diplomaticAction('${countryName}', 'sanctions')">
                            🚫 Economic Sanctions
                        </button>
                        <button class="btn btn-danger" onclick="diplomaticAction('${countryName}', 'covert')">
                            🕵️ Covert Operation (-$0.4T)
                        </button>
                        <button class="btn btn-danger" onclick="diplomaticAction('${countryName}', 'war')">
                            ⚔️ DECLARE WAR
                        </button>
                    ` : `
                        <p style="color: #ff5252;">Currently at war. Manage war from the events panel.</p>
                    `}
                    <button class="btn btn-success" onclick="closeModal()">Close</button>
                </div>
            `;
            
            modal.style.display = 'flex';
        }
        
        function diplomaticAction(countryName, action) {
            const country = gameState.countries.find(c => c.name === countryName);
            if (!country) return;
            
            switch(action) {
                case 'gift':
                    if (gameState.treasury < 0.3) {
                        addLog("Insufficient funds!");
                        return;
                    }
                    gameState.treasury -= 0.3;
                    country.relationValue += 15;
                    gameState.relations += 3;
                    addLog(`Sent aid to ${countryName}. Relations improved.`);
                    break;
                    
                case 'trade':
                    if (country.tradeAgreement) {
                        country.tradeAgreement = false;
                        gameState.economy -= 5;
                        country.relationValue -= 10;
                        addLog(`Cancelled trade agreement with ${countryName}.`);
                    } else {
                        country.tradeAgreement = true;
                        gameState.economy += 8;
                        country.relationValue += 10;
                        addLog(`Established trade agreement with ${countryName}!`);
                    }
                    break;

                case 'alliance':
                    if (gameState.treasury < 0.5) {
                        addLog("Insufficient funds!");
                        return;
                    }
                    gameState.treasury -= 0.5;
                    country.relationValue += 25;
                    country.relation = "ally";
                    gameState.relations += 10;
                    addLog(`Formed alliance with ${countryName}!`);
                    break;
                    
                case 'threaten':
                    country.relationValue -= 20;
                    country.tensions += 15;
                    gameState.relations -= 5;
                    addLog(`Issued military threats to ${countryName}. Tensions rising.`);
                    break;
                    
                case 'sanctions':
                    country.relationValue -= 15;
                    country.tensions += 10;
                    gameState.economy -= 3;
                    country.economy -= 10;
                    addLog(`Imposed economic sanctions on ${countryName}.`);
                    break;
                    
                case 'covert':
                    if (gameState.treasury < 0.4) {
                        addLog("Insufficient funds!");
                        return;
                    }
                    gameState.treasury -= 0.4;
                    const success = Math.random() < 0.6;
                    if (success) {
                        country.military -= 10;
                        country.economy -= 5;
                        addLog(`Covert operation against ${countryName} succeeded!`);
                    } else {
                        country.relationValue -= 30;
                        country.tensions += 25;
                        gameState.relations -= 15;
                        addLog(`Covert operation EXPOSED! ${countryName} is furious!`);
                    }
                    break;
                    
                case 'war':
                    if (confirm(`Are you sure you want to declare war on ${countryName}? This will have major consequences.`)) {
                        country.atWarWithUs = true;
                        country.tensions = 0;
                        gameState.wars.push({
                            enemy: countryName,
                            monthsActive: 0,
                            ourCasualties: 0,
                            theirCasualties: 0,
                            battlesFought: 0
                        });
                        gameState.approval -= 10;
                        gameState.relations -= 15;
                        addLog(`WAR DECLARED on ${countryName}!`);
                        updateWarPanel();
                    }
                    break;
            }
            
            country.relationValue = Math.max(0, Math.min(100, country.relationValue));
            country.relation = getRelationLevel(country.relationValue);
            clampStats();
            updateUI();
            renderCountries();
            closeModal();
        }
        
        function openEconomyMenu() {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <h2>💼 Economic Policy</h2>
                
                <div class="input-group">
                    <label>Tax Rate: ${gameState.taxRate}%</label>
                    <input type="range" min="10" max="60" value="${gameState.taxRate}" 
                           oninput="gameState.taxRate = this.value; this.previousElementSibling.textContent = 'Tax Rate: ' + this.value + '%'">
                    <p style="font-size: 0.9em; margin-top: 5px;">Higher taxes = more revenue but lower approval</p>
                </div>
                
                <div class="action-options">
                    <button class="btn btn-primary" onclick="economicAction('stimulus')">
                        💵 Economic Stimulus (-$1.0T, +Economy)
                    </button>
                    <button class="btn btn-primary" onclick="economicAction('infrastructure')">
                        🏗️ Infrastructure Investment (-$0.8T)
                    </button>
                    <button class="btn btn-primary" onclick="economicAction('jobs')">
                        👷 Jobs Program (-$0.6T, +Approval)
                    </button>
                    <button class="btn btn-secondary" onclick="economicAction('austerity')">
                        📉 Austerity Measures (+$0.4T, -Services)
                    </button>
                    <button class="btn btn-secondary" onclick="economicAction('deregulate')">
                        📜 Deregulate Industries (+Economy, -Healthcare)
                    </button>
                    <button class="btn btn-success" onclick="closeModal()">Close</button>
                </div>
            `;
            
            modal.style.display = 'flex';
        }
        
        function economicAction(action) {
            switch(action) {
                case 'stimulus':
                    if (gameState.treasury < 1.0) {
                        addLog("Insufficient funds!");
                        return;
                    }
                    gameState.treasury -= 1.0;
                    gameState.economy += 15;
                    gameState.approval += 8;
                    addLog("Economic stimulus package passed!");
                    break;
                    
                case 'infrastructure':
                    if (gameState.treasury < 0.8) {
                        addLog("Insufficient funds!");
                        return;
                    }
                    gameState.treasury -= 0.8;
                    gameState.economy += 10;
                    gameState.education += 5;
                    addLog("Infrastructure improvements initiated!");
                    break;
                    
                case 'jobs':
                    if (gameState.treasury < 0.6) {
                        addLog("Insufficient funds!");
                        return;
                    }
                    gameState.treasury -= 0.6;
                    gameState.economy += 8;
                    gameState.approval += 12;
                    addLog("Jobs program launched successfully!");
                    break;
                    
                case 'austerity':
                    gameState.treasury += 0.4;
                    gameState.healthcare -= 8;
                    gameState.education -= 8;
                    gameState.approval -= 15;
                    addLog("Austerity measures implemented. Public unhappy.");
                    break;
                    
                case 'deregulate':
                    gameState.economy += 10;
                    gameState.healthcare -= 5;
                    gameState.approval -= 3;
                    addLog("Industries deregulated. Economic boost expected.");
                    break;
            }
            
            clampStats();
            updateUI();
            closeModal();
        }
        
        function openMilitaryMenu() {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <h2>⚔️ Military Operations</h2>
                
                <div class="input-group">
                    <label>Military Budget: ${gameState.militaryBudget}%</label>
                    <input type="range" min="5" max="50" value="${gameState.militaryBudget}" 
                           oninput="gameState.militaryBudget = this.value; this.previousElementSibling.textContent = 'Military Budget: ' + this.value + '%'">
                </div>
                
                <div class="action-options">
                    <button class="btn btn-primary" onclick="militaryAction('modernize')">
                        🚀 Modernize Forces (-$1.2T, +15 Military)
                    </button>
                    <button class="btn btn-primary" onclick="militaryAction('recruit')">
                        👥 Recruitment Drive (-$0.5T, +8 Military)
                    </button>
                    <button class="btn btn-primary" onclick="militaryAction('exercises')">
                        🎖️ Training Exercises (-$0.3T, +5 Military)
                    </button>
                    <button class="btn btn-secondary" onclick="militaryAction('demobilize')">
                        ☮️ Demobilize (+$0.6T, -10 Military)
                    </button>
                    <button class="btn btn-danger" onclick="militaryAction('nukes')">
                        ☢️ Start Nuclear Program (-$3.0T)
                    </button>
                    <button class="btn btn-success" onclick="closeModal()">Close</button>
                </div>
            `;
            
            modal.style.display = 'flex';
        }
        
        function militaryAction(action) {
            switch(action) {
                case 'modernize':
                    if (gameState.treasury < 1.2) {
                        addLog("Insufficient funds!");
                        return;
                    }
                    gameState.treasury -= 1.2;
                    gameState.military += 15;
                    addLog("Military modernization complete!");
                    break;
                    
                case 'recruit':
                    if (gameState.treasury < 0.5) {
                        addLog("Insufficient funds!");
                        return;
                    }
                    gameState.treasury -= 0.5;
                    gameState.military += 8;
                    addLog("New recruits enlisted!");
                    break;
                    
                case 'exercises':
                    if (gameState.treasury < 0.3) {
                        addLog("Insufficient funds!");
                        return;
                    }
                    gameState.treasury -= 0.3;
                    gameState.military += 5;
                    addLog("Military exercises conducted!");
                    break;
                    
                case 'demobilize':
                    gameState.treasury += 0.6;
                    gameState.military -= 10;
                    gameState.approval += 5;
                    addLog("Forces demobilized. Peace dividend achieved.");
                    break;
                    
                case 'nukes':
                    startNukeProgram();
                    closeModal();
                    return;
            }
            
            clampStats();
            updateUI();
            closeModal();
        }
        
        function openDomesticMenu() {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <h2>🏛️ Domestic Policy</h2>
                
                <div class="input-group">
                    <label>Healthcare Budget: ${gameState.healthcareBudget}%</label>
                    <input type="range" min="5" max="40" value="${gameState.healthcareBudget}" 
                           oninput="gameState.healthcareBudget = this.value; this.previousElementSibling.textContent = 'Healthcare Budget: ' + this.value + '%'">
                </div>
                
                <div class="input-group">
                    <label>Education Budget: ${gameState.educationBudget}%</label>
                    <input type="range" min="5" max="40" value="${gameState.educationBudget}" 
                           oninput="gameState.educationBudget = this.value; this.previousElementSibling.textContent = 'Education Budget: ' + this.value + '%'">
                </div>
                
                <div class="action-options">
                    <button class="btn btn-primary" onclick="domesticAction('universal')">
                        🏥 Universal Healthcare (-$1.5T, +Healthcare)
                    </button>
                    <button class="btn btn-primary" onclick="domesticAction('schools')">
                        🏫 Build Schools (-$0.7T, +Education)
                    </button>
                    <button class="btn btn-primary" onclick="domesticAction('housing')">
                        🏠 Affordable Housing (-$0.9T, +Approval)
                    </button>
                    <button class="btn btn-primary" onclick="domesticAction('environment')">
                        🌳 Environmental Protection (-$0.6T)
                    </button>
                    <button class="btn btn-secondary" onclick="domesticAction('police')">
                        👮 Increase Police Funding (-$0.4T)
                    </button>
                    <button class="btn btn-success" onclick="closeModal()">Close</button>
                </div>
            `;
            
            modal.style.display = 'flex';
        }
        
        function domesticAction(action) {
            switch(action) {
                case 'universal':
                    if (gameState.treasury < 1.5) {
                        addLog("Insufficient funds!");
                        return;
                    }
                    gameState.treasury -= 1.5;
                    gameState.healthcare += 20;
                    gameState.approval += 15;
                    addLog("Universal healthcare implemented!");
                    break;
                    
                case 'schools':
                    if (gameState.treasury < 0.7) {
                        addLog("Insufficient funds!");
                        return;
                    }
                    gameState.treasury -= 0.7;
                    gameState.education += 15;
                    gameState.approval += 8;
                    addLog("New schools constructed!");
                    break;
                    
                case 'housing':
                    if (gameState.treasury < 0.9) {
                        addLog("Insufficient funds!");
                        return;
                    }
                    gameState.treasury -= 0.9;
                    gameState.approval += 12;
                    gameState.economy += 5;
                    addLog("Housing program launched!");
                    break;
                    
                case 'environment':
                    if (gameState.treasury < 0.6) {
                        addLog("Insufficient funds!");
                        return;
                    }
                    gameState.treasury -= 0.6;
                    gameState.approval += 10;
                    gameState.resources += 8;
                    addLog("Environmental protections enacted!");
                    break;
                    
                case 'police':
                    if (gameState.treasury < 0.4) {
                        addLog("Insufficient funds!");
                        return;
                    }
                    gameState.treasury -= 0.4;
                    gameState.approval += 5;
                    addLog("Police funding increased!");
                    break;
            }
            
            clampStats();
            updateUI();
            closeModal();
        }
        
        function openTradeMenu() {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <h2>📦 Trade & Resources</h2>
                <p>Purchase resources from the international market or sell your surplus.</p>
                
                <div class="action-options">
                    <button class="btn btn-primary" onclick="tradeAction('buy_resources')">
                        🛒 Buy Resources (-$0.5T, +15 Resources)
                    </button>
                    <button class="btn btn-primary" onclick="tradeAction('sell_resources')">
                        💰 Sell Resources (+$0.4T, -15 Resources)
                    </button>
                    <button class="btn btn-primary" onclick="tradeAction('buy_tech')">
                        💻 Import Technology (-$0.8T, +Economy)
                    </button>
                    <button class="btn btn-primary" onclick="tradeAction('export')">
                        📤 Export Goods (+$0.6T, +Economy)
                    </button>
                    <button class="btn btn-secondary" onclick="tradeAction('embargo')">
                        🚫 Trade Embargo (-Economy, -Relations)
                    </button>
                    <button class="btn btn-success" onclick="closeModal()">Close</button>
                </div>
            `;
            
            modal.style.display = 'flex';
        }
        
        function tradeAction(action) {
            switch(action) {
                case 'buy_resources':
                    if (gameState.treasury < 0.5) {
                        addLog("Insufficient funds!");
                        return;
                    }
                    gameState.treasury -= 0.5;
                    gameState.resources += 15;
                    addLog("Resources purchased from international markets!");
                    break;
                    
                case 'sell_resources':
                    if (gameState.resources < 15) {
                        addLog("Insufficient resources to sell!");
                        return;
                    }
                    gameState.treasury += 0.4;
                    gameState.resources -= 15;
                    addLog("Resources sold successfully!");
                    break;
                    
                case 'buy_tech':
                    if (gameState.treasury < 0.8) {
                        addLog("Insufficient funds!");
                        return;
                    }
                    gameState.treasury -= 0.8;
                    gameState.economy += 10;
                    gameState.education += 5;
                    addLog("Technology imported!");
                    break;
                    
                case 'export':
                    gameState.treasury += 0.6;
                    gameState.economy += 8;
                    gameState.resources -= 5;
                    addLog("Exports increased!");
                    break;
                    
                case 'embargo':
                    gameState.economy -= 10;
                    gameState.relations -= 15;
                    addLog("Trade embargo imposed. Economic impact expected.");
                    break;
            }
            
            clampStats();
            updateUI();
            closeModal();
        }
        
        function addLog(message) {
            const timestamp = `Year ${gameState.year}, Month ${gameState.month}`;
            gameState.activityLog.unshift({ time: timestamp, message });
            
            if (gameState.activityLog.length > 50) {
                gameState.activityLog.pop();
            }
            
            updateActivityLog();
        }
        
        function updateActivityLog() {
            const log = document.getElementById('activityLog');
            log.innerHTML = gameState.activityLog.map(entry => `
                <div class="log-entry">
                    <div class="log-time">${entry.time}</div>
                    <div>${entry.message}</div>
                </div>
            `).join('');
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }
        
        function exportGame() {
            const data = JSON.stringify(gameState);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `run-a-country-save-year${gameState.year}.json`;
            a.click();
            URL.revokeObjectURL(url);
            addLog("Game saved and exported!");
        }
        
        function importGame() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        gameState = JSON.parse(event.target.result);
                        updateUI();
                        renderCountries();
                        updateActivityLog();
                        updateWarPanel();
                        updateNukePanel();
                        addLog("Game loaded successfully!");
                    } catch (err) {
                        alert("Error loading save file!");
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }
        
        function resetGame() {
            if (confirm("Are you sure you want to start a new game? All progress will be lost.")) {
                if (realtimeInterval) {
                    clearInterval(realtimeInterval);
                }
                
                gameState = {
                    year: 1,
                    month: 1,
                    treasury: 5.0,
                    approval: 55,
                    economy: 60,
                    military: 50,
                    healthcare: 50,
                    education: 50,
                    relations: 50,
                    resources: 70,
                    countries: [],
                    activityLog: [],
                    activeEvent: null,
                    taxRate: 25,
                    militaryBudget: 20,
                    healthcareBudget: 15,
                    educationBudget: 15,
                    eventCooldown: 0,
                    wars: [],
                    nukeProgram: null,
                    realtimeEnabled: true,
                    inheritedCondition: "",
                    gameStarted: false
                };
                
                document.getElementById('eventsContainer').innerHTML = `
                    <div class="event-box">
                        <div class="event-title">Welcome, Mr./Ms. President!</div>
                        <div class="event-description">
                            You're about to take office. Click below to see what kind of situation you're inheriting...
                        </div>
                        <div class="choices">
                            <button class="btn btn-primary" onclick="startGame()">Take Office</button>
                        </div>
                    </div>
                `;
                
                document.getElementById('inheritedStatus').innerHTML = '';
                document.getElementById('warPanel').innerHTML = '';
                document.getElementById('nukePanel').innerHTML = '';
                document.getElementById('countryList').innerHTML = '';
                document.getElementById('activityLog').innerHTML = '';
                
                updateUI();
            }
        }
        
        function gameOver() {
            let reason = "";
            if (gameState.treasury <= 0) {
                reason = "Your country went bankrupt!";
            } else if (gameState.approval <= 0) {
                reason = "You were impeached due to low approval!";
            }
            
            if (realtimeInterval) {
                clearInterval(realtimeInterval);
            }
            
            document.getElementById('eventsContainer').innerHTML = `
                <div class="game-over">
                    <h2>GAME OVER</h2>
                    <p style="font-size: 1.2em; margin-bottom: 20px;">${reason}</p>
                    <p>You lasted ${gameState.year} year(s) and ${gameState.month} month(s)</p>
                    <p style="margin-top: 15px;">Inherited: ${gameState.inheritedCondition}</p>
                    <button class="btn btn-primary" onclick="resetGame()" style="margin-top: 20px;">Start New Game</button>
                </div>
            `;
        }
        
        document.getElementById('modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
        
        window.onload = () => {
            updateUI();
        };
    </script>
</body>
</html>
